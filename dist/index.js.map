{"version":3,"file":"index.js","mappings":"8BACA,IAAIA,EAAsB,CCA1BA,EAAwB,CAACC,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXF,EAAoBI,EAAEF,EAAYC,KAASH,EAAoBI,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDH,EAAwB,CAACS,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,I,sBCElF,MAAM,GAFEI,EAE+B,CAAE,QAAa,IAAMC,EAA0D,SAFnGC,EAAI,CAAC,EAAGhB,EAAoBiB,EAAED,EAAGF,GAAWE,GCMzDE,EAAaC,GACbC,MAAMC,QAAQF,GACR,GAA2BG,UAAUH,EAAII,IAAIL,IAGnDC,aAAeK,SAAWL,aAAeM,KAAeN,EAEjD,MAAPA,GAAiBA,EAAeO,UAE7BC,EAAAA,EAAAA,SAAYR,EAAeO,YAFqB,KAwDzD,EA/CkB,CAChBE,KAAqCC,KAErC,MAAMC,EAAWD,EAAKN,IAAIL,GAIpBa,EAAeD,EAASP,KAAI,CAACS,EAAGC,IAChCD,aAAaR,SAAWQ,aAAaP,KAC/B,0CAAyCQ,YAE/Cb,MAAMC,QAAQW,GACZA,EAAEE,OAAOC,GAAMA,aAAaX,SAAWW,aAAaV,OAC9C,0CAAyCQ,0CAE5CD,EAAET,KAAKa,GAASA,GAAQ,KAAIC,KAAK,IAEnCL,GAAK,KAGRM,EAAgBC,OAAOC,IAAIZ,KAAeG,GAC1CU,EAASC,SAASC,cAAc,OACtCF,EAAOG,UAAYN,EAAcO,OAEjCJ,EAAOK,iBAAiB,kBAAkBC,SAASC,IACjD,MAAMC,EAAmBC,OAAOC,SAASH,EAAQI,aAAa,eAAiB,KAAM,IACrF,IAA0B,IAAtBH,EACF,MAAM,IAAII,MAAM,wDAElB,GAAsD,UAAlDL,EAAQI,aAAa,yBAAsC,CAC7D,MAAME,EAAuBN,EAAQO,cACrCP,EAAQQ,SACP1B,EAASmB,GAAoCF,SAASf,IACrDsB,GAAsBG,YAAYzB,EAAE,GAExC,MACEgB,EAAQO,eAAeG,aAAa5B,EAASmB,GAA8BD,EAC7E,IAEF,MAAMW,EAAWvC,MAAMwC,KAAKnB,EAAOoB,YAChCC,QAAQ9C,GAAqB,UAAfA,EAAE+C,UAAyB/C,EAAEgD,aAAehD,EAAEgD,YAAYnB,OAAOoB,OAAS,IAC3F,OAAIxB,EAAOyB,YAAcP,EAASM,OAAS,EAClCN,EAEFlB,EAAOyB,UAAU,EDlElBpD,MAAWE,E","sources":["webpack://@joyned/html-fairy/webpack/bootstrap","webpack://@joyned/html-fairy/webpack/runtime/define property getters","webpack://@joyned/html-fairy/webpack/runtime/hasOwnProperty shorthand","webpack://@joyned/html-fairy/external module \"escape-html\"","webpack://@joyned/html-fairy/./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }\nvar y = x => () => x\nconst __WEBPACK_NAMESPACE_OBJECT__ = x({ [\"default\"]: () => __WEBPACK_EXTERNAL_MODULE_escape_html_1f5254f1__[\"default\"] });","import escapeHtml from 'escape-html';\n\ntype ElementOrText = Element | Text | Element[] | Text[];\n\ntype SafeArgument = Element | Text | null | undefined | string\n\nconst escapeArg = (arg: unknown): SafeArgument | Array<SafeArgument> => {\n  if (Array.isArray(arg)) {\n    return ([] as Array<SafeArgument>).concat(...arg.map(escapeArg));\n  }\n\n  if (arg instanceof Element || arg instanceof Text) { return arg; }\n\n  if (arg == null || !(arg as object).toString) { return null; }\n\n  return escapeHtml((arg as object).toString());\n};\n\n/**\n * Returns an HTML structure build from the given `htmlString`. If any argument is a HTMLElement\n * The original element will be used and will be nested in the correct nested place.\n */\nconst htmlFairy = <T extends ElementOrText = HTMLElement>(\n  htmlString: TemplateStringsArray, ...args: unknown[]\n): T => {\n  const safeArgs = args.map(escapeArg);\n\n  // Replace every html element argument with a placeholder. After the creation, the original\n  // element will be put back in place instead of the the placeholder.\n  const templateArgs = safeArgs.map((e, i) => {\n    if (e instanceof Element || e instanceof Text) {\n      return `<div class=\"html-fairy-ph\" data-index=\"${i}\"></div>`;\n    }\n    if (Array.isArray(e)) {\n      if (e.every((v) => v instanceof Element || v instanceof Text)) {\n        return `<div class=\"html-fairy-ph\" data-index=\"${i}\" data-placeholder-type=\"array\"></div>`;\n      }\n      return e.map((text) => text ?? '').join('');\n    }\n    return e ?? '';\n  });\n\n  const htmlStringRaw = String.raw(htmlString, ...templateArgs);\n  const parsed = document.createElement('div');\n  parsed.innerHTML = htmlStringRaw.trim();\n\n  parsed.querySelectorAll('.html-fairy-ph').forEach((element) => {\n    const originalArgIndex = Number.parseInt(element.getAttribute('data-index') ?? '-1', 10);\n    if (originalArgIndex === -1) {\n      throw new Error('html-fairy placeholder is defined with no data index');\n    }\n    if (element.getAttribute('data-placeholder-type') === 'array') {\n      const placeholderContainer = element.parentElement;\n      element.remove();\n      (safeArgs[originalArgIndex] as HTMLElement[]).forEach((e) => {\n        placeholderContainer?.appendChild(e);\n      });\n    } else {\n      element.parentElement?.replaceChild(safeArgs[originalArgIndex] as Element, element);\n    }\n  });\n  const children = Array.from(parsed.childNodes)\n    .filter((x) => x.nodeName !== '#text' || (x.textContent && x.textContent.trim().length > 0));\n  if (parsed.firstChild && children.length > 1) {\n    return children as T;\n  }\n  return parsed.firstChild as T;\n};\n\nexport default htmlFairy;\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","y","__WEBPACK_EXTERNAL_MODULE_escape_html_1f5254f1__","x","d","escapeArg","arg","Array","isArray","concat","map","Element","Text","toString","escapeHtml","htmlString","args","safeArgs","templateArgs","e","i","every","v","text","join","htmlStringRaw","String","raw","parsed","document","createElement","innerHTML","trim","querySelectorAll","forEach","element","originalArgIndex","Number","parseInt","getAttribute","Error","placeholderContainer","parentElement","remove","appendChild","replaceChild","children","from","childNodes","filter","nodeName","textContent","length","firstChild"],"sourceRoot":""}